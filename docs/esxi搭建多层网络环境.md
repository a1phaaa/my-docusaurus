---
title: esxi搭建多层网络环境
---
# esxi搭建多层网络环境

# 网络拓补图

![靶场网络拓补图](https://alpha-blog-1300014916.cos.ap-guangzhou.myqcloud.com/img/%E9%9D%B6%E5%9C%BA%E7%BD%91%E7%BB%9C%E6%8B%93%E8%A1%A5%E5%9B%BE.png)

# 准备工作

1. esxi6.7
2. istoreos系统
3. 靶场镜像

![靶场虚拟机](https://alpha-blog-1300014916.cos.ap-guangzhou.myqcloud.com/img/image-20230220223319943.png)

因为**esxi**不支持设置**nat**类型的虚拟网卡，所以就另辟蹊径使用软路由系统来配置网关并结合现有的网络实现三层网络，并且为了不影响原本自用网络的ip占用冲突等问题，把自用网络的子网掩码位改成了**23**，这样就使得**192.168.10.0**和**192.168.11.0**都在同一个网段中，然后把dhcp池设置为**192.168.10.2~192.168.10.254**，然后**192.168.11.0**以后的都用来当作esxi里的虚拟机的IP。

# 软路由系统的选择

现在主流的软路由系统就是**openwrt**和**ikuai**这两个，但为什么不使用这两个而是去使用基于**openwrt**二次开发的**istore os**呢，是因为**openwrt**官网下载的镜像是 **.img**类型的，我试过按照网上的教程去转成**esxi**服务器所使用的虚拟机文件格式，但是导入服务器之后就一直不能进入软路由系统，试了几次之后就放弃了，然后去安装了**ikuai**，系统是能正常进入了但是在设置Lan口的ip的时候，点击完应用之后重启系统后，ip又变回了默认的，后面就想到了之前在B站刷到过的**istore os**，这个系统可以说是比较的傻瓜式，在首页的内网配置中就可以很直接的修改内网的ip网段。对于那些想折腾软路由的xdm，我想说可以试试这个系统，上手简单，而且看了一下，可玩性也挺高的。

![image-20230220234236389](https://alpha-blog-1300014916.cos.ap-guangzhou.myqcloud.com/img/image-20230220234236389.png)

# 总结

对于有个人服务器且装有**esxi**系统又想搭建域的环境，或者说是多层内网服务的环境的师傅来说，可以尝试一下使用这种运行软路由来实现多层网络的思路来解决**esxi**不能设置**nat**虚拟网卡的问题。
